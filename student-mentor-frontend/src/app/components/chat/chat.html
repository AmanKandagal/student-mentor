<div class="flex flex-col h-full bg-gray-50">
  
  <!-- Message Area -->
  <div #scrollContainer class="flex-1 overflow-y-auto p-4 space-y-4">
    
    <!-- Empty State -->
    <div *ngIf="filteredMessages().length === 0" class="flex flex-col items-center justify-center h-full text-gray-400 opacity-60">
      <svg class="w-16 h-16 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
      <p class="text-sm">Start the conversation with {{ targetName }}</p>
    </div>

    <!-- Message List -->
    <div *ngFor="let msg of filteredMessages()" class="flex w-full" 
         [ngClass]="{'justify-end': msg.senderId === myUserId(), 'justify-start': msg.senderId !== myUserId()}">
      
      <div class="max-w-[75%] md:max-w-[60%] flex flex-col" 
           [ngClass]="{'items-end': msg.senderId === myUserId(), 'items-start': msg.senderId !== myUserId()}">
        
        <!-- Bubble -->
        <div class="px-4 py-2 rounded-2xl shadow-sm text-sm break-words relative group"
             [ngClass]="{
               'bg-indigo-600 text-white rounded-tr-none': msg.senderId === myUserId(),
               'bg-white text-gray-800 border border-gray-200 rounded-tl-none': msg.senderId !== myUserId()
             }">
          {{ msg.text }}
        </div>
        
        <!-- Timestamp -->
        <span class="text-[10px] text-gray-400 mt-1 px-1">
          {{ msg.timestamp | date:'shortTime' }}
        </span>
      </div>

    </div>
  </div>

  <!-- Input Area -->
  <div class="bg-white border-t border-gray-200 p-4">
    <div class="flex items-center gap-3 bg-gray-50 px-4 py-2 rounded-full border border-gray-200 focus-within:ring-2 focus-within:ring-indigo-500/20 focus-within:border-indigo-500 transition-all">
      
      <input 
        type="text" 
        [(ngModel)]="newMessage" 
        (keyup.enter)="sendMessage()"
        placeholder="Type your message..."
        class="flex-1 bg-transparent border-none focus:ring-0 text-sm text-gray-700 placeholder-gray-400 outline-none"
      >
      
      <button 
        (click)="sendMessage()" 
        [disabled]="!newMessage.trim()"
        class="p-2 rounded-full transition-all duration-200"
        [ngClass]="newMessage.trim() ? 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-md transform hover:scale-105' : 'bg-gray-200 text-gray-400 cursor-not-allowed'">
        <svg class="w-5 h-5 translate-x-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
      </button>
    </div>
    
    <div class="text-center mt-2">
      <p class="text-[10px] text-gray-400">
        <span *ngIf="chatService.connectionStatus() === 'CONNECTED'" class="text-green-500">● Live Connected</span>
        <span *ngIf="chatService.connectionStatus() !== 'CONNECTED'" class="text-red-400">● Reconnecting...</span>
      </p>
    </div>
  </div>

</div>